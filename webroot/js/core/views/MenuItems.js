define(["jquery","common/views/BaseView","common/constants/SpinPresets","jquery.nSortable"],function(e,t,i){return t.extend({el:"#menu-items",events:{"nSortable-change":"onSort"},$menuItemReorderEndpoint:null,initialize:function(){this.$menuItemReorderEndpoint=this.$el.attr("data-reorder-url"),this.$el.nSortable({handle:"a.move",tabWidth:20,placeholder:"sortable-placeholder",dataAttribute:"data-menu-item-id",maxDepth:2,serializeKey:"MenuItem",leftKey:"lft",rightKey:"rght",animateTarget:!1})},onSort:function(t,n){this.blockThis({backgroundColor:"#fff",spinner:i.large,deltaHeight:-1});var a=n.toArray();for(var r in a)if(a.hasOwnProperty(r)){var o=a[r],d=this.$el.find('li[data-menu-item-id="'+o.id+'"]').first().find("a.wicon-add").first();o.depth>2?d.addClass("hide"):d.removeClass("hide")}e.ajax({type:"post",dataType:"json",url:this.$menuItemReorderEndpoint,data:n.serialize(),cache:!1,success:_.bind(this.unblockThis,this)})}})});