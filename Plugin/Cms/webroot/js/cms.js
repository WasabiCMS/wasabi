/** pages - v0.0.1 */
$(function(){function a(){var a=[];$("#pages").find("li.closed").each(function(){a.push($(this).attr("data-cms-page-id"))}),$.cookie("closed_pages",a,{expires:365})}function b(){var a=d.find("table.routes").attr("data-add-route-url"),b=$("#CmsPageId").val(),c=$("#RouteUrl").val();"undefined"!=typeof a&&"undefined"!=typeof b&&""!==c&&(d.block({backgroundColor:"#fff"}),$.ajax({type:"post",url:a,data:{"Route[url]":c,"Route[type]":$("#RouteType").val(),pageId:b},dataType:"json",success:function(a){d.unblock(),d.html(a)}}))}var c=$("#pages");c.on("click",".expander",function(b){b.preventDefault();var c=$(this),d=c.parent().parent().parent().parent();d.hasClass("closed")?(c.removeClass("wicon-expand").addClass("wicon-collapse"),d.find("ul").first().slideDown(300,function(){d.removeClass("closed"),a()})):(c.removeClass("wicon-collapse").addClass("wicon-expand"),d.find("ul").first().slideUp(300,function(){d.addClass("closed"),a()}))}),c.nSortable({handle:"a.move",placeholder:"sortable-placeholder",dataAttribute:"data-cms-page-id",serializeKey:"CmsPage",leftKey:"lft",rightKey:"rght"}),c.on("nSortable-change",function(a,b){var d=c.attr("data-reorder-url");"undefined"!=typeof d&&"false"!==d&&$.ajax({type:"post",dataType:"json",url:d,data:b.serialize(),cache:!1})});var d=$(".field.routes");$("#CmsPageEditForm").on("submit",function(a){var c=$(a.originalEvent.explicitOriginalTarget).attr("id");("RouteUrl"===c||"RouteType"===c)&&(a.preventDefault(),b())}),d.on("click",'.new-route button[type="submit"]',function(a){a.preventDefault(),b()}),d.on("beforeAjax.modal",function(){d.block({backgroundColor:"#fff"})}),d.on("deleteRoute",function(a,b){d.unblock(),d.html(b)}),d.on("makeDefaultRoute",function(a,b){d.unblock(),d.html(b)});var e=$(".field.layout-attributes");$("#CmsPageCmsLayoutId").on("change",function(){var a=e.attr("data-change-url");if(a){var b=$(this),c=$("#CmsPageId");c=c.length>0?"/"+c.val():"",e.block({backgroundColor:"#fff",onBlock:function(){$.ajax({url:a+"/"+b.val()+c,method:"get",success:function(a){e.unblock(function(){e.html(a)})}})}})}})});
