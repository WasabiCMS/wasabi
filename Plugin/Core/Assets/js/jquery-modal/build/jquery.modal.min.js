/*!
 * jQuery Modal v0.0.1
 *
 * Copyright (c) 2013 Frank FÃ¶rster (http://frankfoerster.com)
 * Licensed under the MIT License
 */
!function(a){"use strict";var b=function(b,c){this.settings=a.extend({},a.fn.modal.defaults,c),this.$body=a("body"),this.$el=a(b),this.$target=a(this.$el.attr("data-target")),this.$targetContents=null,this.$modal=null,this.$modalBackdrop=null,this.$modalWrapper=null,this.$modalContainer=null,this.isOpen=!1,this._primaryEvents=[],this._secondaryEvents=[],console.log(this.$target),this.$target.length>0&&(this._buildEvents(),a.attachEvents(this._primaryEvents))};b.prototype={_buildEvents:function(b){this._primaryEvents=[[this.$el,{click:a.proxy(this._openModal,this)}]],b===!0&&(this._secondaryEvents=[[this.$modalWrapper,{click:a.proxy(function(a){a.target===this.$modalWrapper[0]&&this._closeModal(a)},this)}],[this.$modalContainer,'[data-dismiss="modal"]',[["click",a.proxy(this._closeModal,this)]]],[a(window),{resize:a.proxy(this._onResize,this)}]])},_initDOMElements:function(){this.$modalBackdrop=a('<div class="modal-backdrop"></div>').css({opacity:this.settings.opacity,zIndex:1e4}),this.$modalWrapper=a('<div class="modal-scrollable"></div>').css({zIndex:this.$modalBackdrop.css("zIndex")+1}),this.$modalContainer=a('<div class="modal-container"></div>')},_resetDOMElements:function(){this.$target.append(this.$targetContents),this.$targetContents=null,this.$modalContainer.remove(),this.$modalContainer=null,this.$body.removeClass("modal-open").removeClass("page-overflow"),this.$modalWrapper.remove(),this.$modalWrapper=null,this.$modalBackdrop.remove(),this.$modalBackdrop=null},_openModal:function(b){b.preventDefault(),a.detachEvents(this._primaryEvents),this._initDOMElements(),this._buildEvents(!0),a.attachEvents(this._secondaryEvents),this.$body.toggleClass("page-overflow",a(window).height()<this.$body.height()).addClass("modal-open"),this.$targetContents=this.$target.children(),this.$modalContainer.append(this.$targetContents).css({width:this.settings.width,position:"fixed",left:-99999,top:this.settings.offsetTop}),this.$modalWrapper.append(this.$modalContainer),this.$body.append(this.$modalBackdrop).append(this.$modalWrapper),this._updatePosition(),this.$modalContainer.hide(),this.$modalContainer.fadeIn(),this.isOpen=!0},_closeModal:function(b){b.preventDefault(),a.detachEvents(this._secondaryEvents),a.when.apply(null,[this.$modalContainer.fadeOut(200),this.$modalBackdrop.fadeOut(200)]).then(a.proxy(function(){this._resetDOMElements(),this.isOpen=!1,a.attachEvents(this._primaryEvents)},this))},_updatePosition:function(){var a=this.$modalContainer.outerHeight(),b=this.$modalContainer.offset().top-this.$modalWrapper.offset().top,c=this.$modalWrapper.height(),d=c-a-b<this.settings.offsetTop;d?a+2*this.settings.padding<=c?this.$modalContainer.css({top:"50%",marginTop:-a/2}):this.$modalContainer.css({top:this.settings.padding,marginTop:0}):this.$modalContainer.css({top:this.settings.offsetTop,marginTop:0}),this.$modalContainer.css({position:"absolute",marginLeft:-this.settings.width/2,left:"50%"})},_onResize:function(){this.isOpen&&this._updatePosition()}},a.fn.modal=function(c){return this.each(function(){return a(this).data("Modal")||a(this).data("Modal",new b(this,c)),a(this).data("Modal")})},a.fn.modal.defaults={width:400,offsetTop:200,opacity:.6,padding:20}}(jQuery);