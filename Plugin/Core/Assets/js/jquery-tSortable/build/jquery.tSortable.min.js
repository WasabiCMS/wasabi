/*!
 * jQuery Table Sortable v0.0.1
 *
 * Copyright (c) 2013 Frank FÃ¶rster (http://frankfoerster.com)
 * Licensed under the MIT License
 */
!function(a,b,c){"use strict";var d=function(b,c){if(this.$el=a(b),this.settings=a.extend({},a.fn.tSortable.defaults,c),this.isDragging=!1,this.$tr=null,this.$clone=null,this.$placeholder=null,this.startPosition={},this.trOffset={},this.placeholderHeight=null,this.$scrollParent=null,this._primaryEvents=[],this._secondaryEvents=[],!this.$el.is("table"))throw new Error("DOM element is not supported. Use table!");this._buildEvents(),a.attachEvents(this._primaryEvents)};d.prototype={_buildEvents:function(){this._primaryEvents=[[this.$el,this.settings.items+" "+this.settings.handle,[["mousedown",a.proxy(this._onMouseDown,this)]]]],this._secondaryEvents=[[a(b),{mousemove:a.proxy(this._onMouseMove,this),mouseup:a.proxy(this._onMouseUp,this)}]]},_onMouseDown:function(b){b.preventDefault(),this._initStart(b),a.attachEvents(this._secondaryEvents)},_onMouseUp:function(b){function c(){d.$clone.remove(),d.$clone=null,d.$tr.insertBefore(d.$placeholder),d.$placeholder.remove(),d.$placeholder=null,d.$tr.show(),d.$tr=null,d.$scrollParent=null,d.isDragging=!1,d._trigger("tSortable-change",b)}var d=this;if(a.detachEvents(this._secondaryEvents),this.isDragging)if(this.settings.animateTarget){var e=this.$placeholder.offset();this.$clone.animate({top:e.top,left:e.left},parseInt(this.settings.animationLength),c)}else c()},_onMouseMove:function(b){this.isDragging||(this._initClone(),this._initPlaceholder(),this.$tr.hide(),this.$scrollParent=this.$clone.scrollParent(),this.isDragging=!0),this._updateClonePosition(b),this.settings.scroll===!0&&this._scroll(b),function(c){if(!c._yIntersectsPlaceholder(b)){var d=c.$el.find(c.settings.items).filter(function(){return a(this)[0]!==c.$tr[0]&&"none"!==a(this).css("display")&&"absolute"!==a(this).css("position")&&!a(this).hasClass(c.settings.placeholder)}),e=null,f=null;if(d.each(function(){var c=a(this).position().top,d=c+a(this).outerHeight(),g=parseInt((c+d)/2);return b.pageY>=c&&b.pageY<g?(e=a(this),f="up",void 0):b.pageY>g&&b.pageY<=d?(e=a(this),f="down",void 0):void 0}),null!==e){if("up"===f){if(e.prev().hasClass(c.settings.placeholder))return;return c.$placeholder.insertBefore(e),void 0}if("down"===f){if("none"===e.next().css("display")&&e.next().next().hasClass(c.settings.placeholder))return;c.$placeholder.insertAfter(e)}}}}(this)},_initStart:function(b){this.$tr=a(b.target).closest("tr"),this.startPosition={x:b.pageX,y:b.pageY};var c=this.$tr.offset();this.trOffset={x:this.startPosition.x-c.left,y:this.startPosition.y-c.top}},_initClone:function(){this.$clone=this.$tr.clone(),this.$clone.css({width:this.$tr.outerWidth(),height:this.$tr.outerHeight(),position:"absolute",zIndex:1e4,opacity:this.settings.opacity});var b=this.$tr.find("> td");this.$clone.find("> td").each(function(c){a(this).css("width",b.eq(c).outerWidth())}),this.$el.find("tbody").append(this.$clone)},_initPlaceholder:function(){this.placeholderHeight=this.$clone.outerHeight(),this.$placeholder=a('<tr><td colspan="'+this.$clone.find("td").length+'">&nbsp;</td></tr>'),this.$placeholder.addClass(this.settings.placeholder).find("> td").first().css({height:this.placeholderHeight}),this.$tr.after(this.$placeholder)},_updateClonePosition:function(a){this.$clone.css({left:a.pageX-this.trOffset.x,top:a.pageY-this.trOffset.y})},_scroll:function(d){var e=this.$scrollParent[0],f=this.$scrollParent.offset();if(e!=b&&"HTML"!=e.tagName)f.top+e.offsetHeight-d.pageY<this.settings.scrollSensitivity?e.scrollTop=e.scrollTop+this.settings.scrollSpeed:d.pageY-f.top<this.settings.scrollSensitivity&&(e.scrollTop=e.scrollTop-this.settings.scrollSpeed),f.left+e.offsetWidth-d.pageX<this.settings.scrollSensitivity?e.scrollLeft=e.scrollLeft+this.settings.scrollSpeed:d.pageX-f.left<this.settings.scrollSensitivity&&(e.scrollLeft=e.scrollLeft-this.settings.scrollSpeed);else{var g=a(b),h=a(c);d.pageY-g.scrollTop()<this.settings.scrollSensitivity?g.scrollTop(g.scrollTop()-this.settings.scrollSpeed):h.height()-(d.pageY-g.scrollTop())<this.settings.scrollSensitivity&&g.scrollTop(g.scrollTop()+this.settings.scrollSpeed),d.pageX-g.scrollLeft()<this.settings.scrollSensitivity?g.scrollLeft(g.scrollLeft()-this.settings.scrollSpeed):h.width()-(d.pageX-g.scrollLeft())<this.settings.scrollSensitivity&&g.scrollLeft(g.scrollLeft()+this.settings.scrollSpeed)}},_yIntersectsPlaceholder:function(a){var b=this.$placeholder.offset().top,c=b+this.placeholderHeight;return a.pageY>=b&&a.pageY<=c},_trigger:function(a,b){this.$el.trigger(a,{event:b})}},a.fn.tSortable=function(b){if(!b||"object"==typeof b)return this.each(function(){a(this).data("tSortable")||a(this).data("tSortable",new d(this,b))});if("string"==typeof b&&"_"!==b.charAt(0)){var c=this.data("tSortable");if(!c)throw new Error("tSortable is not initialized on this DOM element.");if(c&&c[b])return c[b].apply(c,Array.prototype.slice.apply(arguments,[1]))}throw new Error('"'+b+'" is no valid api method.')},a.fn.tSortable.defaults={handle:"div",items:"tbody > tr",opacity:.6,placeholder:"placeholder",animateTarget:!0,animationLength:300,scroll:!0,scrollSensitivity:20,scrollSpeed:20}}(jQuery,document,window);